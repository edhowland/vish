#!/usr/bin/env ruby
# ivs.rb - New and improved interactive Vish shell
# This is an outer REPL.
# An inner REPL would use the loop { read() | eval() | print() }  implementation
# as an interactive .vs script.

require_relative '../lib/vish'


eval = Evaluator.new
history = History.new
begin
loop do
  begin
    print 'vish> '
    source = read(history).chomp
    break if source =~ /break|exit|quit/#
    p eval.eval source
  rescue SigInt
  # nop
rescue Parslet::ParseFailed => err
#  rescue Parslet::ParsFailed => err
    puts "Syntax Error: #{err.message}"
    puts err.class.name
  end
end

rescue EndOfFile
  # nop
end